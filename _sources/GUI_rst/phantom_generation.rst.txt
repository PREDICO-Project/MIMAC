Phantom Generation 
==================

Overview
--------

The phantom generation module is used to generate the g4dcm format file necessary to simulate the X-ray projetions using a voxelized phantom in GAMOS/GEANT4. It uses MHD/RAW files as input and transforms them into the g4dcm format. 
The MHD/RAW files can be generated by the VICTRE project, which provides a set of breast phantoms for simulation purposes or other breast phantoms.
To transform the MHD/RAW files into g4dcm format, it is needed to write a material file which contains the information of the materials used in the phantom, their ID and density. This file must be located in the **data/materials/** folder.

Step-by-Step Instructions
-------------------------

1. Create the material file
^^^^^^^^^^^^^^^^^^^^^^^^^^^
    The material file must contain the information of the materials used in the phantom, their ID and density. This file must be located in the **data/materials/** folder. The format of the file is as follows:
    
    .. code-block:: text

        0 0.0012 G4_AIR 0
        1 0.9201 G4_ADIPOSE_TISSUE_ICRP 1	
        2 1.0901 Skin 7
        ...
   
   where the first column is the material ID of the MHD/RAW file, the second column is the density in g/cm^3, the third column is the name of the material and the fourth material is an index of the g4dcm. Similar materials **must** have the same g4dcm index.
   
    .. note:: 
        - Make sure the material name is defined by GEANT4 or is defined in the **/geom/MyMaterials.txt** file.


2. Load the MHD/RAW file
^^^^^^^^^^^^^^^^^^^^^^^^

    - **Open MHD/RAW file**
        - Users can load the MHD/RAW file using the button "Load MHD/RAW file" in the GUI.
        - The MHD/RAW file must be located in the **data/original_mhd/** folder.
    - **Select material file**
        - Users can select the material file through a combobox in the GUI. The files available are the one located in the **data/materials/** folder.
3. Modification of the phantom
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    - **Reset Origin**
        - Users can reset the origin of the phantom using the button "Reset Origin" in the GUI. This will set the origin of the phantom to (0,0,0) in the g4dcm file (recommended).
    - **Free crop**
        - Users can crop the phantom using the button "Free Crop" in the GUI. This will allow users to select a region of interest in the phantom and crop it. 
        - The coordinates of the crop can be modified through entry boxes in the GUI or clicking the **Show Crop planes** button.
        - If **Show Crop planes** button is clicked, the crop planes will be shown in the GUI. The crop planes can be moved using the mouse.
        - Once the crop is done, users can directly generate the g4dcm pressing the button "Generate g4dcm file" in the GUI.
        - The button **Hide Crop planes** will hide the crop planes and eliminate the crop selection.
    

4. VICTRE's phantom modifications
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    - **Remove Chest Wall**: The chest wall of the VICTRE's breast phantom is removed.
    - **Include compression paddle**: The compression paddle of the VICTRE's breast phantom is included.
    - **Remove Air**: Slices made just by air are removed.

.. note:: 
    - If you are working with a database of breast phantoms, maybe you need to rotate it or made some modifications. 
    - A new MHD/RAW file will be generated with the modifications made. It will be located in the **data/new_mhd/** folder with the original file name.
    - The RAM consuption of this module can be high if the voxelized phantom contains a los of voxels.
    